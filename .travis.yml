language: ruby
cache: bundler
rvm:
  - 2.4

gemfiles:
  - Gemfile
  - Gemfile.ci # rails 5

branches:
  only:
    - master

services:
  - elasticsearch
  - redis-server

before_install:
  - gem install bundler -v 1.17.3
  - bundle _1.17.3_ install

before_script:
  - cp config/secrets.yml.dist config/secrets.yml
  # Wait for Elasticsearch
  - sleep 10
  - bundle exec rake kkuleomi:index:init
